<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>PLC Controllers App</title>

    <link rel="stylesheet" href="../../../assets/styles/mainWindow.css">

    <style>
        .header-row {
            margin-top: 45px;
            margin-bottom: 35px;
        }
    </style>
</head>

<body style="background-color: #6095C9; text-align: center; margin: 10px; display: none;">

    <div class="container">
        <h1 class="header" style="text-align: left;">E5_NB</h1>
        <div class="row header-row">
            <div class="col-6">
                <button type="button" class="btn station" id="autoManual"
                    data-bind="text: autoManual, style: autoManualStyle">
                </button>
                <!-- <a href="mainWindow.html">
                    <img src="../../assets//images/home-v1.png" alt="home" class="thumbnails" style="height: 55px" />
                </a> -->
            </div>

            <div class="col-6">
                <div class="footer" style="margin-top: 0px" data-bind="text: time"></button>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- Station 1 -->

            <div class="col-sm-4">
                <button type="button" class="btn station" data-bind="style: ll1Style"
                    onclick="window.location.href='ll7TimeWindow.html'">
                    SC3-1
                </button>
            </div>

            <!-- Station 2 -->
            <div class="col-sm-4">
                <button type="button" class="btn station" data-bind="style: ll2Style"
                    onclick="window.location.href='ll8TimeWindow.html'">
                    SC3-2
                </button>
            </div>

            <!-- Station 3 -->
            <div class="col-sm-4">
                <button type="button" class="btn station" data-bind="style: ll3Style"
                    onclick="window.location.href='ll9TimeWindow.html'">
                    SC3-3
                </button>
            </div>
        </div>

        <!-- Row 2 -->
        <div class="row" style="margin-top: 15px;">
            <!-- On 1 -->
            <div class="col-sm-4">
                <button type="button" class="btn station" data-bind="style: ll1OnStyle" id="ll1On">
                    On
                </button>
            </div>

            <!-- On 2 -->
            <div class="col-sm-4">
                <button type="button" class="btn station" data-bind="style: ll2OnStyle" id="ll2On">
                    On
                </button>
            </div>

            <!-- On 3 -->
            <div class="col-sm-4">
                <button type="button" class="btn station" data-bind="style: ll3OnStyle" id="ll3On">
                    On
                </button>
            </div>
        </div>

        <!-- Row 3 -->
        <div class="row" style="margin-top: 15px;">
            <!-- On 1 -->
            <div class="col-sm-4">
                <button type="button" class="btn station" data-bind="style: ll1OffStyle" id="ll1Off">
                    Off
                </button>
            </div>

            <!-- On 2 -->
            <div class="col-sm-4">
                <button type="button" class="btn station" data-bind="style: ll2OffStyle" id="ll2Off">
                    Off
                </button>
            </div>

            <!-- On 3 -->
            <div class="col-sm-4">
                <button type="button" class="btn station" data-bind="style: ll3OffStyle" id="ll3Off">
                    Off
                </button>
            </div>
        </div>

        <!-- Footer -->
        <div class="row">
            <span>
                <a href="detailWindow.html">
                    <img src="../../../assets/images/left.png" alt="home" class="thumbnails" style="height: 55px" />
                </a>
                <a href="../../mainWindow.html">
                    <img src="../../../assets/images/home-v1.png" alt="home" class="thumbnails" style="height: 55px" />
                </a>
            </span>
        </div>

    </div>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script>window.$ = window.jQuery = require('jquery');</script>
    <script src="../../../node_modules/bootstrap/dist/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="../../../node_modules/bootstrap/dist/css/bootstrap.min.css">

    <!-- Knockout -->
    <script src="../../../helpers/knockout.js"></script>

    <!-- IPC script -->
    <script>
        const electron = require('electron');
        const { ipcRenderer } = electron;
        const { CHANNELS } = require('../../../helpers/environments');
        const STATION1 = require('../../../data/station1');
        const Store = require('electron-store');
        const store = new Store();
        const keys = STATION1.storedKeys;

        const greenColor = {
            'background-color': 'green'
        };
        const redColor = {
            'background-color': 'red'
        };
        const whiteColor = {
            'background-color': 'white'
        };
        let vm;

        // Start View Model
        const _startViewModel = () => {
            // Knockout functions
            function AppViewModel() {
                this.time = ko.observable('Reading...');
                this.autoManualStyle = ko.observable(greenColor);
                this.autoManual = ko.observable('AUTO');

                this.ll1Style = ko.observable(greenColor);
                this.ll1OnStyle = ko.observable(whiteColor);
                this.ll1OffStyle = ko.observable(whiteColor);

                this.ll2Style = ko.observable(greenColor);
                this.ll2OnStyle = ko.observable(whiteColor);
                this.ll2OffStyle = ko.observable(whiteColor);

                this.ll3Style = ko.observable(greenColor);
                this.ll3OnStyle = ko.observable(whiteColor);
                this.ll3OffStyle = ko.observable(whiteColor);
            }

            // Activates knockout.js
            vm = new AppViewModel();
            ko.applyBindings(vm);
        };

        // Get from store
        const _getFromStore = () => {
            const headerDatetime = store.get(keys.headerDatetime);
            if (headerDatetime) {
                vm.time(headerDatetime);
            }

            if (store.get(CHANNELS.autoManual3) === true) {
                vm.autoManualStyle(greenColor);
                vm.autoManual('AUTO');
            } else {
                vm.autoManualStyle(redColor);
                vm.autoManual('MANUAL');
            }

            if (store.get(CHANNELS.ll7On) === true) {
                vm.ll1Style(greenColor);
            } else {
                vm.ll1Style(redColor);
            }

            if (store.get(CHANNELS.ll8On) === true) {
                vm.ll2Style(greenColor);
            } else {
                vm.ll2Style(redColor);
            }

            if (store.get(CHANNELS.ll9On) === true) {
                vm.ll3Style(greenColor);
            } else {
                vm.ll3Style(redColor);
            }

        };

        // Read streaming
        const _readStreaming = () => {
            console.log('reading');
            ipcRenderer.on(CHANNELS.datetime, (e, datetime) => {
                vm.time(datetime);
            });

            ipcRenderer.on(CHANNELS.onlineStatus, (e, id, status) => {
                // console.log(id, status);
                if (id === 'N1') {
                    if (status === true) {
                        vm.S1Style(greenColor);
                    } else {
                        vm.S1Style(redColor);
                    }
                }
            });

            const _readLLn = () => {
                ipcRenderer.on(CHANNELS.ll7On, (e, isOn) => {
                    if (isOn) {
                        vm.ll1Style(greenColor);
                    } else {
                        vm.ll1Style(redColor);
                    }
                });

                // ipcRenderer.on(CHANNELS.ll1Off, (e, isOn) => {
                //     if (isOn) {
                //         vm.ll1OnStyle(redColor);
                //     } else {
                //         vm.ll1OnStyle(whiteColor);
                //     }
                // });

                ipcRenderer.on(CHANNELS.ll8On, (e, isOn) => {
                    if (isOn) {
                        vm.ll2Style(greenColor);
                    } else {
                        vm.ll2Style(redColor);
                    }
                });

                // ipcRenderer.on(CHANNELS.ll8Off, (e, isOn) => {
                //     if (isOn) {
                //         vm.ll1OnStyle(redColor);
                //     } else {
                //         vm.ll1OnStyle(whiteColor);
                //     }
                // });

                ipcRenderer.on(CHANNELS.ll9On, (e, isOn) => {
                    if (isOn) {
                        vm.ll3Style(greenColor);
                    } else {
                        vm.ll3Style(redColor);
                    }
                });

                // ipcRenderer.on(CHANNELS.ll9Off, (e, isOn) => {
                //     if (isOn) {
                //         vm.ll1OnStyle(redColor);
                //     } else {
                //         vm.ll1OnStyle(whiteColor);
                //     }
                // });
            }
            _readLLn();

            ipcRenderer.on(CHANNELS.autoManual3, (e, autoManual) => {
                if (autoManual) {
                    vm.autoManual('AUTO');
                    vm.autoManualStyle(greenColor);
                } else {
                    vm.autoManual('MANUAL');
                    vm.autoManualStyle(redColor);

                   
                }
            });  
        };

        const _buttonClick = () => {

            // Detect button click
            document.getElementById('ll1On').onclick = () => {
                ipcRenderer.send(CHANNELS.ll7On, true);
            };

            document.getElementById('ll2On').onclick = () => {
                ipcRenderer.send(CHANNELS.ll8On, true);
            };

            document.getElementById('ll3On').onclick = () => {
                ipcRenderer.send(CHANNELS.ll9On, true);
            };

            document.getElementById('ll1Off').onclick = () => {
                ipcRenderer.send(CHANNELS.ll7Off, true);
            };

            document.getElementById('ll2Off').onclick = () => {
                ipcRenderer.send(CHANNELS.ll8Off, true);
            };

            document.getElementById('ll3Off').onclick = () => {
                ipcRenderer.send(CHANNELS.ll9Off, true);
            };

            document.getElementById('autoManual').onclick = () => {
                const autoManual = store.get(CHANNELS.autoManual3);
                if (autoManual) {
                    ipcRenderer.send(CHANNELS.autoManual3, false);
                } else {
                    ipcRenderer.send(CHANNELS.autoManual3, true);
                }
            };

        };

        // Show when ready
        $(document).ready(() => {
            $('body').show();
            // Send station id to init connection
            // ipcRenderer.send(CHANNELS.onNewStation, 5);

            _startViewModel();
            _getFromStore();
            _readStreaming();
            _buttonClick();
        });



    </script>

</body>

</html>