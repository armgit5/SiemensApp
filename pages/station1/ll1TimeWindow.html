<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>BTS APP</title>

    <link rel="stylesheet" href="../../assets/styles/mainWindow.css">

    <style>
        .station-mid {
            width: 150px;
        }

        .station-longer {
            width: 300px;
        }

        .time-border {
            border: 2px solid gray;
            border-radius: 5px;
        }

        .col-4 input {
            background-color: #FCCBA1;
        }
    </style>
</head>

<body style="background-color: #6095C9; text-align: center; margin: 10px; display: none;">

    <div class="container">
        <div class="row header-row">
            <div class="col-6">
                <h1 class="header" style="text-align: left; margin: 0px;">
                    LL1
                </h1>

            </div>

            <div class="col-6">
                <div class="row">
                    <div class="col-6">
                        <!-- <button type="button" class="btn station" style="padding: 0px" id="pcEdit"
                            data-bind="text: pcEdit"></button> -->
                    </div>
                    <div class="col-6">
                        <div class="footer" style="margin-top: 0px" data-bind="text: time">
                        </div>
                    </div>

                </div>
            </div>
        </div>

        <!-- Time On Off -->
        <div class="row">
            <div class="col-6 time-border" style="background-color: lightgreen;">
                Time On
            </div>
            <div class="col-6 time-border" style="background-color: yellow;">
                Time Off
            </div>
            <!-- <div class="col2"></div> -->
        </div>

        <!-- Step 1 -->
        <div class="row">
            <div class="col-1">
                <div class="row" style="padding-left: 15px; padding-top: 10px;">1</div>
            </div>

            <!-- Detail 1 -->
            <div class="col-5">
                <div class="row">
                    <div class="col-4" style="padding-left: 5px">
                        <input type="text" class="form-control" placeholder="HH" id="step1OnHH"
                            data-bind="value: step1OnHH">
                    </div>
                    <div class="col-4" style="padding-left: 5px">
                        <input type="text" class="form-control" placeholder="MM" id="step1OnMM"
                            data-bind="value: step1OnMM">
                    </div>
                    <div class="col-4" style="padding-left: 5px">
                        <input type="text" class="form-control" placeholder="SS" id="step1OnSS"
                            data-bind="value: step1OnSS">
                    </div>
                </div>
            </div>

            <!-- Detail 2 -->
            <div class="col-5">
                <div class="row">
                    <div class="col-4" style="padding-right: 5px">
                        <input type="text" class="form-control" placeholder="HH" id="step1OffHH"
                            data-bind="value: step1OffHH">
                    </div>
                    <div class="col-4" style="padding-right: 5px;">
                        <input type="text" class="form-control" placeholder="MM" id="step1OffMM"
                            data-bind="value: step1OffMM">
                    </div>
                    <div class="col-4" style="padding-right: 5px">
                        <input type="text" class="form-control" placeholder="SS" id="step1OffSS"
                            data-bind="value: step1OffSS">
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 2 -->
        <div class="row" style="margin-top: 0px">
            <div class="col-1">
                <div class="row" style="padding-left: 15px; padding-top: 10px;">2</div>
            </div>

            <!-- Detail 1 -->
            <div class="col-5">
                <div class="row">
                    <div class="col-4" style="padding-left: 5px">
                        <input type="text" class="form-control" placeholder="HH" id="step2OnHH"
                            data-bind="value: step2OnHH">
                    </div>
                    <div class="col-4" style="padding-left: 5px">
                        <input type="text" class="form-control" placeholder="MM" id="step2OnMM"
                            data-bind="value: step2OnMM">
                    </div>
                    <div class="col-4" style="padding-left: 5px">
                        <input type="text" class="form-control" placeholder="SS" id="step2OnSS"
                            data-bind="value: step2OnSS">
                    </div>
                </div>
            </div>

            <!-- Detail 2 -->
            <div class="col-5">
                <div class="row">
                    <div class="col-4" style="padding-right: 5px">
                        <input type="text" class="form-control" placeholder="HH" id="step2OffHH"
                            data-bind="value: step2OffHH">
                    </div>
                    <div class="col-4" style="padding-right: 5px;">
                        <input type="text" class="form-control" placeholder="MM" id="step2OffMM"
                            data-bind="value: step2OffMM">
                    </div>
                    <div class="col-4" style="padding-right: 5px">
                        <input type="text" class="form-control" placeholder="SS" id="step2OffSS"
                            data-bind="value: step2OffSS">
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 3 -->
        <div class="row" style="margin-top: 0px">
            <div class="col-1">
                <div class="row" style="padding-left: 15px; padding-top: 10px;">3</div>
            </div>

            <!-- Detail 1 -->
            <div class="col-5">
                <div class="row">
                    <div class="col-4" style="padding-left: 5px">
                        <input type="text" class="form-control" placeholder="HH" id="step3OnHH"
                            data-bind="value: step3OnHH">
                    </div>
                    <div class="col-4" style="padding-left: 5px">
                        <input type="text" class="form-control" placeholder="MM" id="step3OnMM"
                            data-bind="value: step3OnMM">
                    </div>
                    <div class="col-4" style="padding-left: 5px">
                        <input type="text" class="form-control" placeholder="SS" id="step3OnSS"
                            data-bind="value: step3OnSS">
                    </div>
                </div>
            </div>

            <!-- Detail 2 -->
            <div class="col-5">
                <div class="row">
                    <div class="col-4" style="padding-right: 5px">
                        <input type="text" class="form-control" placeholder="HH" id="step3OffHH"
                            data-bind="value: step3OffHH">
                    </div>
                    <div class="col-4" style="padding-right: 5px;">
                        <input type="text" class="form-control" placeholder="MM" id="step3OffMM"
                            data-bind="value: step3OffMM">
                    </div>
                    <div class="col-4" style="padding-right: 5px">
                        <input type="text" class="form-control" placeholder="SS" id="step3OffSS"
                            data-bind="value: step3OffSS">
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 4 -->
        <div class="row" style="margin-top: 0px">
            <div class="col-1">
                <div class="row" style="padding-left: 15px; padding-top: 10px;">4</div>
            </div>

            <!-- Detail 1 -->
            <div class="col-5">
                <div class="row">
                    <div class="col-4" style="padding-left: 5px">
                        <input type="text" class="form-control" placeholder="HH" id="step4OnHH"
                            data-bind="value: step4OnHH">
                    </div>
                    <div class="col-4" style="padding-left: 5px">
                        <input type="text" class="form-control" placeholder="MM" id="step4OnMM"
                            data-bind="value: step4OnMM">
                    </div>
                    <div class="col-4" style="padding-left: 5px">
                        <input type="text" class="form-control" placeholder="SS" id="step4OnSS"
                            data-bind="value: step4OnSS">
                    </div>
                </div>
            </div>

            <!-- Detail 2 -->
            <div class="col-5">
                <div class="row">
                    <div class="col-4" style="padding-right: 5px">
                        <input type="text" class="form-control" placeholder="HH" id="step4OffHH"
                            data-bind="value: step4OffHH">
                    </div>
                    <div class="col-4" style="padding-right: 5px;">
                        <input type="text" class="form-control" placeholder="MM" id="step4OffMM"
                            data-bind="value: step4OffMM">
                    </div>
                    <div class="col-4" style="padding-right: 5px">
                        <input type="text" class="form-control" placeholder="SS" id="step4OffSS"
                            data-bind="value: step4OffSS">
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="row">
            <span>
                <a href="llWindow.html">
                    <img src="../../assets/images/left.png" alt="home" class="thumbnails" style="height: 55px" />
                </a>
                <a href="mainWindow.html">
                    <img src="../../assets/images/home-v1.png" alt="home" class="thumbnails" style="height: 55px" />
                </a>
            </span>
        </div>

    </div>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script>window.$ = window.jQuery = require('jquery');</script>
    <script src="../../node_modules/bootstrap/dist/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="../../node_modules/bootstrap/dist/css/bootstrap.min.css">
    <script src="../../helpers/knockout.js"></script>

    <!-- IPC script -->
    <script>
        const electron = require('electron');
        const { ipcRenderer } = electron;
        const { CHANNELS } = require('../../helpers/environments');
        const STATION1 = require('../../data/station1');
        const Store = require('electron-store');
        const store = new Store();
        const keys = STATION1.storedKeys;

        const greenColor = {
            'background-color': 'green'
        };
        const redColor = {
            'background-color': 'red'
        };
        let vm;

        // Start View Model
        const _startViewModel = () => {
            // Knockout functions
            function AppViewModel() {
                this.time = ko.observable('Reading...');
                this.S1Style = ko.observable(redColor);
                this.S1_1Style = ko.observable(redColor);

                // Step 1
                this.step1OnHH = ko.observable('00');
                this.step1OnMM = ko.observable('00');
                this.step1OnSS = ko.observable('00');
                this.step1OffHH = ko.observable('00');
                this.step1OffMM = ko.observable('00');
                this.step1OffSS = ko.observable('00');

                // Step 2
                this.step2OnHH = ko.observable('00');
                this.step2OnMM = ko.observable('00');
                this.step2OnSS = ko.observable('00');
                this.step2OffHH = ko.observable('00');
                this.step2OffMM = ko.observable('00');
                this.step2OffSS = ko.observable('00');

                // Step 3
                this.step3OnHH = ko.observable('00');
                this.step3OnMM = ko.observable('00');
                this.step3OnSS = ko.observable('00');
                this.step3OffHH = ko.observable('00');
                this.step3OffMM = ko.observable('00');
                this.step3OffSS = ko.observable('00');

                // Step 4
                this.step4OnHH = ko.observable('00');
                this.step4OnMM = ko.observable('00');
                this.step4OnSS = ko.observable('00');
                this.step4OffHH = ko.observable('00');
                this.step4OffMM = ko.observable('00');
                this.step4OffSS = ko.observable('00');
            }

            // Activates knockout.js
            vm = new AppViewModel();
            ko.applyBindings(vm);
        };

        // Get from store
        const _getFromStore = () => {
            const headerDatetime = store.get(keys.headerDatetime);
            vm.time(headerDatetime);
        };

        // Read streaming
        const _readStreaming = () => {
            ipcRenderer.on(CHANNELS.datetime, (e, datetime) => {
                vm.time(datetime);
            });
            
        };

        const _buttonClick = () => {
            function setInputFilter(textbox, inputFilter) {
                ["input", "keydown", "keyup", "mousedown", "mouseup", "select", "contextmenu", "drop"].forEach(function (event) {
                    textbox.addEventListener(event, function () {
                        if (inputFilter(this.value)) {
                            this.oldValue = this.value;
                            this.oldSelectionStart = this.selectionStart;
                            this.oldSelectionEnd = this.selectionEnd;
                        } else if (this.hasOwnProperty("oldValue")) {
                            this.value = this.oldValue;
                            this.setSelectionRange(this.oldSelectionStart, this.oldSelectionEnd);
                        }
                    });
                });
            }

            // STEP 1 //
            const _step1Click = () => {
                setInputFilter(document.getElementById('step1OnHH'), function (value) {
                    return /^\d*$/.test(value) && (value === "" || parseInt(value) <= 23 && value.length <= 2);
                });
                $('#step1OnHH').keyup(function () {
                    const HH = parseInt(this.value);
                    ipcRenderer.send(STATION1.datetime.ll1.onHH, HH);
                });

                setInputFilter(document.getElementById('step1OnMM'), function (value) {
                    return /^\d*$/.test(value) && (value === "" || parseInt(value) <= 59 && value.length <= 2);
                });
                $('#step1OnMM').keyup(function () {
                    const MM = this.value;
                    console.log(MM);
                    ipcRenderer.send(CHANNELS.ll1.step1.onMM, MM);
                });

                setInputFilter(document.getElementById('step1OnSS'), function (value) {
                    return /^\d*$/.test(value) && (value === "" || parseInt(value) <= 59 && value.length <= 2);
                });
                $('#step1OnSS').keyup(function () {
                    const SS = this.value;
                    console.log(SS);
                    ipcRenderer.send(CHANNELS.ll1.step1.onSS, SS);
                });

                // Off //
                setInputFilter(document.getElementById('step1OffHH'), function (value) {
                    return /^\d*$/.test(value) && (value === "" || parseInt(value) <= 23 && value.length <= 2);
                });
                $('#step1OffHH').keyup(function () {
                    const HH = this.value;
                    console.log(HH);
                });

                setInputFilter(document.getElementById('step1OffMM'), function (value) {
                    return /^\d*$/.test(value) && (value === "" || parseInt(value) <= 59 && value.length <= 2);
                });
                $('#step1OffMM').keyup(function () {
                    const MM = this.value;
                    console.log(MM);
                });

                setInputFilter(document.getElementById('step1OffSS'), function (value) {
                    return /^\d*$/.test(value) && (value === "" || parseInt(value) <= 59 && value.length <= 2);
                });
                $('#step1OffSS').keyup(function () {
                    const SS = this.value;
                    console.log(SS);
                });
            };
            _step1Click();

            // Step 2
            const _step2Click = () => {
                setInputFilter(document.getElementById('step2OnHH'), function (value) {
                    return /^\d*$/.test(value) && (value === "" || parseInt(value) <= 23 && value.length <= 2);
                });
                $('#step2OnHH').keyup(function () {
                    const HH = parseInt(this.value);
                    ipcRenderer.send(CHANNELS.ll1.step1.onHH, HH);
                });

                setInputFilter(document.getElementById('step2OnMM'), function (value) {
                    return /^\d*$/.test(value) && (value === "" || parseInt(value) <= 59 && value.length <= 2);
                });
                $('#step2OnMM').keyup(function () {
                    const MM = this.value;
                    console.log(MM);
                    ipcRenderer.send(CHANNELS.ll1.step1.onMM, MM);
                });

                setInputFilter(document.getElementById('step2OnSS'), function (value) {
                    return /^\d*$/.test(value) && (value === "" || parseInt(value) <= 59 && value.length <= 2);
                });
                $('#step2OnSS').keyup(function () {
                    const SS = this.value;
                    console.log(SS);
                    ipcRenderer.send(CHANNELS.ll1.step1.onSS, SS);
                });

                // Step 1 Off //
                setInputFilter(document.getElementById('step2OffHH'), function (value) {
                    return /^\d*$/.test(value) && (value === "" || parseInt(value) <= 23 && value.length <= 2);
                });
                $('#step2OffHH').keyup(function () {
                    const HH = this.value;
                    console.log(HH);
                });

                setInputFilter(document.getElementById('step2OffMM'), function (value) {
                    return /^\d*$/.test(value) && (value === "" || parseInt(value) <= 59 && value.length <= 2);
                });
                $('#step2OffMM').keyup(function () {
                    const MM = this.value;
                    console.log(MM);
                });

                setInputFilter(document.getElementById('step2OffSS'), function (value) {
                    return /^\d*$/.test(value) && (value === "" || parseInt(value) <= 59 && value.length <= 2);
                });
                $('#step2OffSS').keyup(function () {
                    const SS = this.value;
                    console.log(SS);
                });
            };
            // _step2Click();

            // Step 3


        };

        const _setLimits = () => {
            // Restricts input for the given textbox to the given inputFilter.



        };
        // Show when ready
        $(document).ready(() => {
            $('body').show();
            // Send station id to init connection
            ipcRenderer.send(CHANNELS.onLLn, 1);

            _startViewModel();
            _getFromStore();
            _readStreaming();
            _buttonClick();
            _setLimits();
        });

    </script>

</body>

</html>