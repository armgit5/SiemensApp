<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>PLC Controllers App</title>

  <link rel="stylesheet" href="../assets/styles/mainWindow.css">

  <style>
    .long {
      width: 200px;
    }

    .main {
      margin: 0px;
    }
  </style>
</head>

<body style="background-color: #6095C9; text-align: center; margin: 10px; display: none;">

  <div class="container">

    <div class="row">
      <div class="col-12" style="margin-top: 30px; margin-left: 10px;">
          <h1 class="header" style=" text-align: left;
          width: 500px;
          border: 1px solid black;
          background-color: white;
          padding: 10px;
          color: black; border-radius: 5px; margin: 0px;
          text-align: center;">PLC CONTROLLERS APP</h1>
      </div>

      <!-- <div class="col-4" style="margin-top: 50px;">
          <div class="footer" style="margin-top: 0px; padding: 10px;">
              HH:MM</button>
          </div>
      </div> -->
  </div>

    <div class="row" style="margin-top: 30px;">
      <!-- Station 1 -->

      <div class="col-3" style="padding: 0px;">
        <button type="button" class="btn station long" style="background-color: yellow; width: 120px;"
          onclick="window.location.href='detailWindow.html'">
          <!-- Siam <span class="dot" data-bind="style: SiamStyle"></span> -->

          <div class="row main">
            <div class="col-4" style="padding: 0; padding-top: 10px; padding-left: 15px;">
              <span>SIAM </span>
            </div>
            <div class="col-8" style="padding: 0; padding-left: 10px;">
              <div class="col" style="padding: 0;">
                <span class="dot" data-bind="style: SiamStyle1" style="margin: 0"></span>
                <span class="dot" data-bind="style: SiamStyle2" style="margin: 0"></span>
              </div>
              <div class="col" style="padding: 0;">
                <span class="dot" data-bind="style: SiamStyle3" style="margin: 0"></span>
                <span class="dot" data-bind="style: SiamStyle4" style="margin: 0"></span>
              </div>
            </div>
          </div>

        </button>
      </div>

      <!-- Station 2 -->
      <div class="col-4" style="padding: 0px;">
        <button type="button" class="btn station long" style="background-color: white; width: 170px;"
          onclick="window.location.href='./E4/detailWindow.html'">
          <!-- E4 <span class="dot" style="background-color: #50FF00;"></span> -->
          <div class="row main">
            <div class="col-8" style="padding: 0;padding-top: 10px">
              <span>ASOK (E4) </span>
            </div>
            <div class="col-4" style="padding: 0">
              <div class="col" style="padding: 0">
                <span class="dot" data-bind="style: E4Style2"></span>
                <!-- <span class="dot" style="background-color: green; margin: 0px"></span> -->
              </div>
              <div class="col" style="padding: 0">

                <span class="dot" data-bind="style: E4Style1"></span>
                <!-- <span class="dot" style="background-color: green; margin: 0px"></span> -->
              </div>
            </div>
          </div>
        </button>
      </div>

      <!-- Station 3 -->
      <div class="col-5" style="padding: 0px;">
        <button type="button" class="btn station long" style="background-color: white; width: 212px;"
          onclick="window.location.href='./E5/detailWindow.html'">
          <!-- E5 <span class="dot" style="background-color: #50FF00;"></span> -->
          <div class="row main">
            <div class="col-9" style="padding: 0; padding-left: 9px; padding-top: 10px;">
              <span>PHROM PHONG (E5) </span>
            </div>
            <div class="col-3" style="padding: 0; padding-right: 7px;">
              <div class="col" style="padding: 0">
                <span class="dot" data-bind="style: E5Style2"></span>
                <!-- <span class="dot" style="background-color: green; margin: 0px"></span> -->
              </div>
              <div class="col" style="padding: 0">

                <span class="dot" data-bind="style: E5Style1"></span>
                <!-- <span class="dot" style="background-color: green; margin: 0px"></span> -->
              </div>
            </div>
          </div>
        </button>
      </div>
    </div>

    <div class="row" style="margin-top: 30px;">
      <!-- Station 4 -->
      <div class="col-6" style="padding: 0px;">
        <button type="button" class="btn station long" style="background-color: white; width: 260px;"
          onclick="window.location.href='./S2/detailWindow.html'">
          <!-- S2 <span class="dot" style="background-color: lightcoral;"></span> -->
          <div class="row main">
            <div class="col-8" style="padding: 0; padding-left: 15px; padding-top: 10px">
              <span>SALA DANG (S2) </span>
            </div>
            <div class="col-4" style="padding: 0">
              <div class="col" style="padding: 0">
                <span class="dot" data-bind="style: S2Style2"></span>
                <!-- <span class="dot" style="background-color: green; margin: 0px"></span> -->
              </div>
              <div class="col" style="padding: 0">

                <span class="dot" data-bind="style: S2Style1"></span>
                <!-- <span class="dot" style="background-color: green; margin: 0px"></span> -->
              </div>
            </div>
          </div>
        </button>
      </div>

      <!-- Station 5 -->
      <div class="col-6" style="padding: 0px;">
        <button type="button" class="btn station long" style="background-color: white; width: 260px; padding: 0px;"
          onclick="window.location.href='./S3/detailWindow.html'">
          <!-- S3 <span class="dot" style="background-color: lightcoral;"></span> -->
          <div class="row main">
            <div class="col-8" style="padding: 0; padding-left: 15px; padding-top: 10px">
              <span>CHONG NON SI (S3) </span>
            </div>
            <div class="col-4" style="padding: 0">
              <div class="col" style="padding: 0">
                <span class="dot" data-bind="style: S3Style2"></span>
                <!-- <span class="dot" style="background-color: green; margin: 0px"></span> -->
              </div>
              <div class="col" style="padding: 0">

                <span class="dot" data-bind="style: S3Style1"></span>
                <!-- <span class="dot" style="background-color: green; margin: 0px"></span> -->
              </div>
            </div>
          </div>
        </button>
      </div>
    </div>

    <!-- Footer -->
    <div class="row">
      <div class="col-2">
      </div>
      <div class="col-8">
        <div class="footer" data-bind="text: time" style="width: 250px; padding-top: 15px;">
        </div>
      </div>
      <div class="col-2">
      </div>
    </div>

  </div>

  <!-- Optional JavaScript -->
  <!-- jQuery first, then Popper.js, then Bootstrap JS -->
  <script>window.$ = window.jQuery = require('jquery');</script>
  <script src="../node_modules/bootstrap/dist/js/bootstrap.min.js"></script>
  <link rel="stylesheet" href="../node_modules/bootstrap/dist/css/bootstrap.min.css">
  <script src="../helpers/knockout.js"></script>

  <!-- IPC script -->
  <script>
    const electron = require('electron');
    const { ipcRenderer } = electron;
    const { CHANNELS, COLORS, monthNames } = require('../helpers/environments');
    const STATION1 = require('../data/station1');
    const Store = require('electron-store');
    const store = new Store();
    const keys = STATION1.storedKeys;

    const greenColor = {
      'background-color': COLORS.green
    };
    const redColor = {
      'background-color': COLORS.red
    };
    const grayColor = {
      'background-color': COLORS.gray
    };
    let vm;

    // Start View Model
    const _startViewModel = () => {

      // Knockout functions
      function AppViewModel() {
        this.time = ko.observable('Reading...');
        this.SiamStyle1 = ko.observable(redColor);
        this.SiamStyle2 = ko.observable(redColor);
        this.SiamStyle3 = ko.observable(redColor);
        this.SiamStyle4 = ko.observable(redColor);

        this.E4Style1 = ko.observable(redColor);
        this.E4Style2 = ko.observable(redColor);

        this.E5Style1 = ko.observable(redColor);
        this.E5Style2 = ko.observable(redColor);

        this.S2Style1 = ko.observable(redColor);
        this.S2Style2 = ko.observable(redColor);

        this.S3Style1 = ko.observable(redColor);
        this.S3Style2 = ko.observable(redColor);
      }

      // Activates knockout.js
      vm = new AppViewModel();
      ko.applyBindings(vm);

    }

    // Get from store
    const _getFromStore = () => {
      const headerDatetime = store.get(keys.headerDatetime);
      if (headerDatetime) {
        vm.time(headerDatetime);
      }

      // Station 1
      const data1 = store.get('S1_M217_0');
      if (data1 !== undefined) {
        if (data1) {
          vm.SiamStyle1(greenColor);
        } else {
          vm.SiamStyle1(redColor);
        }
      }

      // Station 2
      const data2 = store.get('S2_M218_2');
      if (data2 !== undefined) {
        if (data2) {
          vm.SiamStyle2(greenColor);
        } else {
          vm.SiamStyle2(redColor);
        }
      }

      // Station 3
      const data3 = store.get('S3_M217_0');
      if (data3 !== undefined) {
        if (data3) {
          vm.SiamStyle3(greenColor);
        } else {
          vm.SiamStyle3(redColor);
        }
      }

      // Station 4
      const data4 = store.get('S4_M218_2');
      if (data4 !== undefined) {
        if (data4) {
          vm.SiamStyle4(greenColor);
        } else {
          vm.SiamStyle4(redColor);
        }
      }

      // Asok 
      // Station 5
      const data5 = store.get('S5_M218_3');
      if (data5 !== undefined) {
        if (data5) {
          vm.E4Style1(greenColor);
        } else {
          vm.E4Style1(redColor);
        }
      }

      // Station 6
      const data6 = store.get('S6_M218_3');
      if (data6 !== undefined) {
        if (data6) {
          vm.E4Style2(greenColor);
        } else {
          vm.E4Style2(redColor);
        }
      }

      // E5
      // Station 7
      const data7 = store.get('S7_M218_3');
      if (data7 !== undefined) {
        if (data7) {
          vm.E5Style1(greenColor);
        } else {
          vm.E5Style1(redColor);
        }
      }

      const data8 = store.get('S8_M218_3');
      if (data8 !== undefined) {
        if (data8) {
          vm.E5Style2(greenColor);
        } else {
          vm.E5Style2(redColor);
        }
      }

      // S2 
      const data9 = store.get('S9_M218_3');
      if (data9 !== undefined) {
        if (data9) {
          vm.S2Style1(greenColor);
        } else {
          vm.S2Style1(redColor);
        }
      }

      const data10 = store.get('S10_M218_3');
      if (data10 !== undefined) {
        if (data10) {
          vm.S2Style2(greenColor);
        } else {
          vm.S2Style2(redColor);
        }
      }

      // S3
      const data11 = store.get('S11_M218_3');
      if (data11 !== undefined) {
        if (data11) {
          vm.S3Style1(greenColor);
        } else {
          vm.S3Style1(redColor);
        }
      }

      const data12 = store.get('S12_M218_3');
      if (data12 !== undefined) {
        if (data12) {
          vm.S3Style2(greenColor);
        } else {
          vm.S3Style2(redColor);
        }
      }


    };

    // Read streaming
    const _readStreaming = () => {

      // Date time streaming

      setInterval(() => {

        const d = new Date(); // for now
        const hh = d.getHours(); // => 9
        const mm = d.getMinutes(); // =>  30
        const ss = d.getSeconds();
        const day = d.getDate();
        const mo = d.getMonth();
        const yr = d.getFullYear();

        const dt = `${day} ${monthNames[mo]} ${yr} ${hh}:${mm}:${ss}`;
        console.log(dt);
        vm.time(dt);

      }, 1000);


      // ipcRenderer.on(CHANNELS.datetime, (e, datetime) => {
      //   vm.time(datetime);
      // });

      // Siam
      ipcRenderer.on(CHANNELS.onStation1, (e, data) => {

        if (data.M217_0 !== undefined) {
          if (data.M217_0) {
            vm.SiamStyle1(greenColor);
          } else {
            vm.SiamStyle1(redColor);
          }
        }

      });

      ipcRenderer.on(CHANNELS.onStation2, (e, data) => {
        if (data.M218_2 !== undefined) {
          if (data.M218_2) {
            vm.SiamStyle2(greenColor);
          } else {
            vm.SiamStyle2(redColor);
          }
        }


      });

      ipcRenderer.on(CHANNELS.onStation3, (e, data) => {
        if (data.M217_0 !== undefined) {
          if (data.M217_0) {
            vm.SiamStyle3(greenColor);
          } else {
            vm.SiamStyle3(redColor);
          }
        }
      });

      ipcRenderer.on(CHANNELS.onStation4, (e, data) => {
        if (data.M218_2 !== undefined) {
          if (data.M218_2) {
            vm.SiamStyle4(greenColor);
          } else {
            vm.SiamStyle4(redColor);
          }
        }

      });

      // Asok 
      ipcRenderer.on(CHANNELS.onStation5, (e, data) => {
        if (data.M218_3 !== undefined) {
          if (data.M218_3) {
            vm.E4Style1(greenColor);
          } else {
            vm.E4Style1(redColor);
          }
        }
      });

      ipcRenderer.on(CHANNELS.onStation6, (e, data) => {
        if (data.M218_3 !== undefined) {
          if (data.M218_3) {
            vm.E4Style2(greenColor);
          } else {
            vm.E4Style2(redColor);
          }
        }
      });

      // E5
      ipcRenderer.on(CHANNELS.onStation7, (e, data) => {
        if (data.M218_3 !== undefined) {
          if (data.M218_3) {
            vm.E5Style1(greenColor);
          } else {
            vm.E5Style1(redColor);
          }
        }
      });

      ipcRenderer.on(CHANNELS.onStation8, (e, data) => {
        if (data.M218_3 !== undefined) {
          if (data.M218_3) {
            vm.E5Style2(greenColor);
          } else {
            vm.E5Style2(redColor);
          }
        }
      });

      // S2 
      ipcRenderer.on(CHANNELS.onStation9, (e, data) => {
        if (data.M218_3 !== undefined) {
          if (data.M218_3) {
            vm.S2Style1(greenColor);
          } else {
            vm.S2Style1(redColor);
          }
        }

      });

      ipcRenderer.on(CHANNELS.onStation10, (e, data) => {
        if (data.M218_3 !== undefined) {
          if (data.M218_3) {
            vm.S2Style2(greenColor);
          } else {
            vm.S2Style2(redColor);
          }
        }
      });

      // S3
      ipcRenderer.on(CHANNELS.onStation11, (e, data) => {
        if (data.M218_3 !== undefined) {
          if (data.M218_3) {
            vm.S3Style1(greenColor);
          } else {
            vm.S3Style1(redColor);
          }
        }
      });

      ipcRenderer.on(CHANNELS.onStation12, (e, data) => {
        if (data.M218_3 !== undefined) {
          if (data.M218_3) {
            vm.S3Style2(greenColor);
          } else {
            vm.S3Style2(redColor);
          }
        }
      });


    };

    // Show when ready
    $(document).ready(() => {
      $('body').show();
      // Send station id to init connection
      ipcRenderer.send(CHANNELS.onNewStation, 1);

      // Send to query status
      ipcRenderer.send(CHANNELS.onStationsCheck, 1);

      _startViewModel();
      _getFromStore();
      _readStreaming();
    });

  </script>

</body>

</html>