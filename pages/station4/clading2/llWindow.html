<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>PLC Controllers App</title>

    <link rel="stylesheet" href="../../../assets/styles/mainWindow.css">

    <style>
        .header-row {
            margin-top: 45px;
            margin-bottom: 35px;
        }

        .station {
            height: 50px;
        }
    </style>
</head>

<body style="background-color: #6095C9; text-align: center; margin: 10px; display: none;">

    <div class="container">
        <!-- <h1 class="header" style="text-align: left;">Clading 2, EB</h1> -->
        <!-- Header -->
        <div class="row" style="margin-top: 0px;">
            <div class="col-8" style="padding-left: 5%">
                <h1 class="header" style=" text-align: left;
                        padding: 10px;
                        color: white;
                        margin: 0px;">Clading 2, EB</h1>
            </div>

            <div class="col-4">
                <div class="footer" style="margin-top: 15px; margin-left: 75px;" data-bind="text: time"></button>
                </div>
            </div>
        </div>

        <!-- Auto Manual -->
        <div class="row header-row" style="margin: 0; margin-top: 0px;">
            <div class="col-6" style="text-align: left; left: -5%;">
                <button type="button" class="btn station" id="autoManual" style="height: 55px; width: 175px;"
                    data-bind="text: autoManual, style: autoManualStyle">
                </button>
            </div>
        </div>

        <div class="row" style="margin-top: 15px;">
            <!-- Station 1 -->

            <div class="col-sm-4">
                <button type="button" class="btn station" data-bind="style: ll1Style"
                    onclick="window.location.href='ll1TimeWindow.html'">
                    CD2-1
                </button>
            </div>

            <!-- Station 2 -->
            <div class="col-sm-4">
                <button type="button" class="btn station" data-bind="style: ll2Style"
                    onclick="window.location.href='ll2TimeWindow.html'">
                    CD2-2
                </button>
            </div>

            <!-- Station 3 -->
            <div class="col-sm-4">
                <button type="button" class="btn station" data-bind="style: ll3Style"
                    onclick="window.location.href='ll3TimeWindow.html'">
                    CD2-3
                </button>
            </div>
        </div>

        <!-- Row 2 -->
        <div class="row" style="margin-top: 15px;">
            <!-- On 1 -->
            <div class="col-sm-4">
                <button type="button" class="btn station" data-bind="style: ll1OnStyle" id="ll1On">
                    On
                </button>
            </div>

            <!-- On 2 -->
            <div class="col-sm-4">
                <button type="button" class="btn station" data-bind="style: ll2OnStyle" id="ll2On">
                    On
                </button>
            </div>

            <!-- On 3 -->
            <div class="col-sm-4">
                <button type="button" class="btn station" data-bind="style: ll3OnStyle" id="ll3On">
                    On
                </button>
            </div>
        </div>

        <!-- Row 3 -->
        <div class="row" style="margin-top: 15px;">
            <!-- On 1 -->
            <div class="col-sm-4">
                <button type="button" class="btn station" data-bind="style: ll1OffStyle" id="ll1Off">
                    Off
                </button>
            </div>

            <!-- On 2 -->
            <div class="col-sm-4">
                <button type="button" class="btn station" data-bind="style: ll2OffStyle" id="ll2Off">
                    Off
                </button>
            </div>

            <!-- On 3 -->
            <div class="col-sm-4">
                <button type="button" class="btn station" data-bind="style: ll3OffStyle" id="ll3Off">
                    Off
                </button>
            </div>
        </div>

        <!-- Footer -->
        <div class="row" style="margin-top: 25px;">
            <span>
                <a href="../detailWindow.html">
                    <img src="../../../assets/images/left.png" alt="home" class="thumbnails" style="height: 55px" />
                </a>
                <a href="../../mainWindow.html">
                    <img src="../../../assets/images/home-v1.png" alt="home" class="thumbnails" style="height: 55px" />
                </a>
            </span>
        </div>

    </div>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script>window.$ = window.jQuery = require('jquery');</script>
    <script src="../../../node_modules/bootstrap/dist/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="../../../node_modules/bootstrap/dist/css/bootstrap.min.css">

    <!-- Knockout -->
    <script src="../../../helpers/knockout.js"></script>

    <!-- IPC script -->
    <script>
        const electron = require('electron');
        const { ipcRenderer } = electron;
        const { CHANNELS, COLORS } = require('../../../helpers/environments');
        const STATION1 = require('../../../data/station1');
        const Store = require('electron-store');
        const store = new Store();
        const keys = STATION1.storedKeys;

        const greenColor = {
            'background-color': COLORS.greenOnOff
        };
        const redColor = {
            'background-color': 'red'
        };
        const whiteColor = {
            'background-color': 'white'
        };
        let vm;

        // Start View Model
        const _startViewModel = () => {
            // Knockout functions
            function AppViewModel() {
                this.time = ko.observable('Reading...');
                this.autoManualStyle = ko.observable(greenColor);
                this.autoManual = ko.observable('AUTO');

                this.ll1Style = ko.observable(greenColor);
                this.ll1OnStyle = ko.observable(whiteColor);
                this.ll1OffStyle = ko.observable(whiteColor);

                this.ll2Style = ko.observable(greenColor);
                this.ll2OnStyle = ko.observable(whiteColor);
                this.ll2OffStyle = ko.observable(whiteColor);

                this.ll3Style = ko.observable(greenColor);
                this.ll3OnStyle = ko.observable(whiteColor);
                this.ll3OffStyle = ko.observable(whiteColor);
            }

            // Activates knockout.js
            vm = new AppViewModel();
            ko.applyBindings(vm);
        };

        // Get from store
        const _getFromStore = () => {
            const headerDatetime = store.get(keys.headerDatetime);
            if (headerDatetime) {
                vm.time(headerDatetime);
            }

            if (store.get(CHANNELS.autoManual) === true) {
                vm.autoManualStyle(greenColor);
                vm.autoManual('AUTO');
            } else {
                vm.autoManualStyle(redColor);
                vm.autoManual('MANUAL');
            }

            if (store.get(CHANNELS.ll10On) === true) {
                vm.ll1Style(greenColor);
            } else {
                vm.ll1Style(redColor);
            }

            if (store.get(CHANNELS.ll11On) === true) {
                vm.ll2Style(greenColor);
            } else {
                vm.ll2Style(redColor);
            }

            if (store.get(CHANNELS.ll12On) === true) {
                vm.ll3Style(greenColor);
            } else {
                vm.ll3Style(redColor);
            }

        };

        // Read streaming
        const _readStreaming = () => {
            console.log('reading');
            ipcRenderer.on(CHANNELS.datetime, (e, datetime) => {
                vm.time(datetime);
            });

            ipcRenderer.on(CHANNELS.onlineStatus, (e, id, status) => {
                // console.log(id, status);
                if (id === 'N1') {
                    if (status === true) {
                        vm.S1Style(greenColor);
                    } else {
                        vm.S1Style(redColor);
                    }
                }
            });

            const _readLLn = () => {
                ipcRenderer.on(CHANNELS.ll10On, (e, isOn) => {
                    if (isOn) {
                        vm.ll1Style(greenColor);
                    } else {
                        vm.ll1Style(redColor);
                    }
                });

                // ipcRenderer.on(CHANNELS.ll10Off, (e, isOn) => {
                //     if (isOn) {
                //         vm.ll1OnStyle(redColor);
                //     } else {
                //         vm.ll1OnStyle(whiteColor);
                //     }
                // });

                ipcRenderer.on(CHANNELS.ll11On, (e, isOn) => {
                    if (isOn) {
                        vm.ll2Style(greenColor);
                    } else {
                        vm.ll2Style(redColor);
                    }
                });

                // ipcRenderer.on(CHANNELS.ll11Off, (e, isOn) => {
                //     if (isOn) {
                //         vm.ll1OnStyle(redColor);
                //     } else {
                //         vm.ll1OnStyle(whiteColor);
                //     }
                // });

                ipcRenderer.on(CHANNELS.ll12On, (e, isOn) => {
                    if (isOn) {
                        vm.ll3Style(greenColor);
                    } else {
                        vm.ll3Style(redColor);
                    }
                });

                // ipcRenderer.on(CHANNELS.ll12Off, (e, isOn) => {
                //     if (isOn) {
                //         vm.ll1OnStyle(redColor);
                //     } else {
                //         vm.ll1OnStyle(whiteColor);
                //     }
                // });
            }
            _readLLn();

            ipcRenderer.on(CHANNELS.autoManual, (e, autoManual) => {
                if (autoManual) {
                    vm.autoManual('AUTO');
                    vm.autoManualStyle(greenColor);
                } else {
                    vm.autoManual('MANUAL');
                    vm.autoManualStyle(redColor);


                }
            });
        };

        const _buttonClick = () => {

            // Detect button click
            document.getElementById('ll1On').onclick = () => {
                ipcRenderer.send(CHANNELS.ll10On, true);
            };

            document.getElementById('ll2On').onclick = () => {
                ipcRenderer.send(CHANNELS.ll11On, true);
            };

            document.getElementById('ll3On').onclick = () => {
                ipcRenderer.send(CHANNELS.ll12On, true);
            };

            document.getElementById('ll1Off').onclick = () => {
                ipcRenderer.send(CHANNELS.ll10Off, true);
            };

            document.getElementById('ll2Off').onclick = () => {
                ipcRenderer.send(CHANNELS.ll11Off, true);
            };

            document.getElementById('ll3Off').onclick = () => {
                ipcRenderer.send(CHANNELS.ll12Off, true);
            };

            document.getElementById('autoManual').onclick = () => {
                const autoManual = store.get(CHANNELS.autoManual);
                if (autoManual) {
                    ipcRenderer.send(CHANNELS.autoManual, false);
                } else {
                    ipcRenderer.send(CHANNELS.autoManual, true);
                }
            };

        };

        // Show when ready
        $(document).ready(() => {
            $('body').show();
            // Send station id to init connection
            // ipcRenderer.send(CHANNELS.onNewStation, 3);

            _startViewModel();
            _getFromStore();
            _readStreaming();
            _buttonClick();
        });



    </script>

</body>

</html>